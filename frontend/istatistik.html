<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“Š Ä°statistik Paneli</title>
</head>
<body>
  <h2>ðŸ“Š Ä°statistik Paneli</h2>
  <div id="stats">
    <p>YÃ¼kleniyor...</p>
  </div>

  <script>
    const token = localStorage.getItem("access_token");

    async function loadStats() {
      const res = await fetch("/stats", {
        headers: {
          "Authorization": "Bearer " + token
        }
      });
      const data = await res.json();

      const statsDiv = document.getElementById("stats");
      statsDiv.innerHTML = `
        <ul>
          <li>ðŸ§¾ Toplam Fatura SayÄ±sÄ±: <strong>${data.fatura_sayisi}</strong></li>
          <li>ðŸ’° Toplam Gelir (KDV hariÃ§): <strong>${data.toplam_gelir} TL</strong></li>
          <li>ðŸ“ˆ Toplam KDV: <strong>${data.toplam_kdv} TL</strong></li>
          <li>ðŸ‘¤ En Ã‡ok Fatura Kesilen MÃ¼ÅŸteri: <strong>${data.en_cok_fatura_kesilen_musteri || "Yok"}</strong></li>
          <li>ðŸ”¢ Bu MÃ¼ÅŸteriye Kesilen Fatura SayÄ±sÄ±: <strong>${data.fatura_sayisi_bu_musteri}</strong></li>
        </ul>
      `;
    }

    loadStats();
  </script>

<hr>
<h3>GPT-4 Finansal Analiz</h3>
<textarea id="prompt" rows="4" cols="60" placeholder="Analiz iÃ§in mesajÄ±nÄ±zÄ± yazÄ±n..."></textarea><br>
<button onclick="sendToGPT()">Analiz Et</button>
<pre id="result"></pre>

<script>
  async function sendToGPT() {
    const prompt = document.getElementById('prompt').value;
    const resultArea = document.getElementById('result');
    resultArea.innerText = "YÃ¼kleniyor...";

    try {
      const response = await fetch('/ai/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt })
      });
      const data = await response.json();
      resultArea.innerText = data.result || data.error || "YanÄ±t alÄ±namadÄ±.";
    } catch (error) {
      resultArea.innerText = "Hata: " + error;
    }
  }
</script>


<hr>
<a href="/frontend/chat.html" style="text-decoration:none;">
  <button style="padding: 8px 12px; background-color: #007bff; color: white; border: none; border-radius: 4px;">
    ðŸ¤– GPT Sohbet AsistanÄ±
  </button>
</a>

</body>
</html>